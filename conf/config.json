{
  "api": {
    "serverName": "Traffic Splitter",
    "port": 80,
    "maxConnections": 1024,
    "upstreamKeepAlive": {
      "maxSockets": 1024,
      "maxFreeSockets": 64,
      "timeout": 60000,
      "keepAliveTimeout": 30000
    },
    "emitMetricsInterval": {
      "http": 10000,
      "https": 10000
    }
  },
  "bunyan": {
    "name": "traffic-splitter",
    "streams": []
  },
  "browserId": {
    "cookie": "bid",
    "maxAge": 315360000,
    "length": 12
  },
  "domains": [
    "qa.tvg.com",
    "us.betfair.com",
    "betfair.local",
    "dev.betfair",
    "dev.betfair:443",
    "dev.betfair:8443",
    "localhost.betfair.com:8443",
    "localhost",
    "bjgbiflinjbdggehcddcbncdddomop"
  ],
  "CORS": {
    "headers": [
        "ORIGIN",
        "X_REQUESTED_WITH",
        "X-Requested-with",
        "Content-Type",
        "Accept"
    ],
    "credentials": "true",
    "methods": [
        "GET",
        "POST",
        "DELETE",
        "OPTIONS",
        "PUT"
    ],
    "max-age": "600"
  },
  "circuitBreaker": {
    "enabled": true,
    "dryrun": false,
    "interval": 5000,
    "numIntervalPeriods": 6,
    "responseTimeThreshold": {
      "min": 5000,
      "max": 10000
    },
    "errorCode": "503",
    "errorMessage": "Server is temporarily at capacity"
  },
  "upstreams": [
    {
      "name": "cookies",
      "enabled": true,
      "criteria": {
        "in": {
          "cookie": [
            {
              "name": "olx",
              "value": "se vale x, olx!"
            },
            {
              "name": "oly",
              "value": "se vale y, oly!"
            },
            {
              "name": "olz",
              "value": "se vale z, olz!"
            }
          ]
        },
        "out": {}
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "www.olx.pt",
          "port": 80,
          "headers": {
            "host": "www.olx.pt"
          }
        }
      }
    },
    {
      "name": "TVG",
      "enabled": true,
      "criteria": {
        "in": {
          "host": [
            "localhost",
            "www.mindera.com"
          ],
          "path": [
            "/tvg",
            "/rule"
          ],
          "geoip": [
            {
              "country": "PT",
              "region": "16",
              "city": "Viana do Castelo"
            },
            {
              "country": "PT",
              "region": "13",
              "city": "Porto"
            },
            {
              "country": "PT",
              "region": "08",
              "city": "Faro"
            }
          ],
          "agent": [
            "Chrome",
            "Mozilla"
          ],
          "device": [
            {
              "device": "desktop",
              "browser": "Firefox",
              "version": {
                "from": 35,
                "to": 37
              }
            },
            {
              "device": "mobile"
            },
            {
              "device": "desktop",
              "browser": "Chrome",
              "version": {
                "from": 35,
                "to": 42
              }
            }
          ],
          "bucket": [
            {
              "min": 0,
              "max": 50
            }
          ],
          "cookie": [
            {
              "name": "letme",
              "value": "in"
            },
            {
              "name": "keepme",
              "value": "in"
            }
          ],
          "visitor": false,
          "or": [
            {
              "cookie": [
                {
                  "name": "secret",
                  "value": "pizza"
                }
              ]
            },
            {
              "path": [
                "/pizza"
              ]
            }
          ]
        },
        "out": {
          "host": [
            "www.google.pt"
          ],
          "path": [
            "/forbidden",
            "/notallowed"
          ],
          "cookie": [
            {
              "name": "letme",
              "value": "out"
            }
          ],
          "geoip": [
            {
              "country": "US",
              "region": "TX",
              "city": "San Antonio"
            },
            {
              "country": "PT",
              "region": "03",
              "city": "Braga"
            },
            {
              "country": "PT",
              "region": "11",
              "city": "Lisboa"
            }
          ],
          "agent": [
            "Safari"
          ],
          "visitor": true,
          "and": [
            {
              "cookie": [
                {
                  "name": "secret",
                  "value": "francesinha"
                }
              ]
            },
            {
              "path": [
                "/francesinha"
              ]
            }
          ]
        }
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "service.tvg.com",
          "port": 80
        }
      }
    },
    {
      "name": "SAPO",
      "enabled": true,
      "criteria": {
        "in": {
          "path": [
            "/allowed",
            "/enter/please"
          ],
          "bucket": [
            {
              "min": 50,
              "max": 100
            }
          ],
          "cookie": [
            {
              "name": "amIallowed",
              "value": "yes"
            }
          ],
          "agent": [
            "Opera"
          ],
          "geoip": [
            {
              "country": "PT"
            }
          ],
          "device": [
            {
              "device": "phone",
              "browser": "Chrome",
              "version": {
                "from": 40,
                "to": 42
              }
            }
          ],
          "visitor": "",
          "myCustomRule1": {
            "value": 0
          },
          "myCustomRule2": [
            "one",
            "two",
            "three"
          ]
        },
        "out": {
          "agent": [
            "Netscape"
          ],
          "device": [
            {
              "device": "tablet"
            }
          ],
          "myCustomRule1": {
            "value": 1
          },
          "myCustomRule2": [
            "one",
            "three"
          ]
        }
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "www.sapo.pt",
          "port": 80,
          "headers": {
            "host": "www.sapo.pt"
          }
        }
      }
    },
    {
      "name": "https",
      "enabled": "true",
      "criteria": {
        "in": {
          "bucket": [
            {
              "min": 0,
              "max": 100
            }
          ],
          "path": [
            "/package"
          ]
        },
        "out": {}
      },
      "upstream": {
        "type": "serveSecure",
        "options": {
          "host": "www.npmjs.com",
          "port": 443,
          "headers": {
            "host": "www.npmjs.com"
          }
        }
      }
    },
    {
      "name": "redirect",
      "enabled": "true",
      "criteria": {
        "in": {
          "bucket": [
            {
              "min": 0,
              "max": 10
            },
            {
              "min": 10,
              "max": 30
            },
            {
              "min": 40,
              "max": 70
            },
            {
              "min": 70,
              "max": 90
            }
          ],
          "path": [
            "/redirect"
          ]
        },
        "out": {
          "host": [
            "www.trafficsplitter.io",
            "www.npmjs.com/package/trafficsplitter"
          ]
        }
      },
      "upstream": {
        "type": "redirect",
        "options": {
          "location": "http://mindera.com/",
          "statusCode": 302,
          "cookies": {
              "redirected": {
                  "maxAge": 600000,
                  "domain": "http://mindera.com/",
                  "path": "/",
                  "value": "hell yeah"
              },
              "mindera": {
                  "maxAge": 600000,
                  "domain": "http://mindera.com/",
                  "path": "/",
                  "value": "rocks"
              }
          }
        }
      }
    },
    {
      "name": "vip",
      "enabled": true,
      "criteria": {
        "in": {
          "bucket": [
            {
              "min": 50,
              "max": 100
            }
          ],
          "cookie": [
            {
              "name": "letme",
              "value": "in"
            }
          ]
        },
        "out": {
          "cookie": [
            {
              "name": "supersecret",
              "value": "duarte"
            }
          ]
        }
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "www.google.pt",
          "port": 80,
          "headers": {
            "host": "www.google.pt",
            "X-Access-Token": "randomToken",
            "X-Access-ID": "randomID"
          },
          "rewrite": {
            "expression": "(.*)",
            "to": "/noticias/atualidade"
          },
          "cookies": {
              "name": {
                  "maxAge": 600000,
                  "domain": "localhost",
                  "path": "/",
                  "value": "duarte"
              },
              "surname": {
                  "maxAge": 600000,
                  "domain": "localhost",
                  "path": "/",
                  "value": "mendes"
              },
              "age": {
                  "maxAge": 600000,
                  "domain": "localhost",
                  "path": "/",
                  "value": "22"
              }
          }
        }
      }
    },
    {
      "name": "visitor",
      "enabled": "true",
      "criteria": {
        "in": {
          "visitor": true
        },
        "out": {}
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "www.google.com",
          "port": 80,
          "headers": {
            "host": "www.google.com"
          },
          "cookies": {
              "name": {
                  "maxAge": 600000,
                  "domain": "localhost",
                  "path": "/",
                  "value": "guest"
              },
              "age": {
                  "maxAge": 600000,
                  "domain": "localhost",
                  "path": "/",
                  "value": "0"
              }
          }
        }
      }
    },
    {
      "name": "disabled",
      "enabled": false,
      "criteria": {
        "in": {},
        "out": {}
      },
      "upstream": {
        "type": "serve",
        "options": {
          "host": "www.facebook.com",
          "port": 80,
          "headers": {
            "host": "www.facebook.com"
          }
        }
      }
    }
  ]
}
